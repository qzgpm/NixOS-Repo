#!/bin/zsh

# ==============================
# Editor setup
# ==============================
if command -v nvim >/dev/null 2>&1; then
  alias vim="nvim"
  alias vimdiff="nvim -d"
fi

# ==============================
# X session
# ==============================
[ -n "$XINITRC" ] && [ -f "$XINITRC" ] && alias startx="startx $XINITRC"

# ==============================
# Sudo shortcuts
# ==============================
for cmd in mount umount sv updatedb su shutdown poweroff reboot; do
  alias "$cmd"="sudo $cmd"
done
unset cmd

# ==============================
# Local script editor
# ==============================
se() {
  local choice
  choice="$(find ~/.local/bin -mindepth 1 -printf '%P\n' | fzf)"
  [ -f "$HOME/.local/bin/$choice" ] && "$EDITOR" "$HOME/.local/bin/$choice"
}

# ==============================
# Git helpers (functions instead of aliases)
# ==============================
gadd() { git add .; }
gcommit() { git commit -m "$*"; }
gpush() {
  local branch
  branch="$(git rev-parse --abbrev-ref HEAD 2>/dev/null)"
  [ -n "$branch" ] && git push -u origin "$branch" || echo "Not a git repository"
}
gpull() {
  local branch
  branch="$(git rev-parse --abbrev-ref HEAD 2>/dev/null)"
  [ -n "$branch" ] && git pull origin "$branch" || echo "Not a git repository"
}

# ==============================
# Verbose and default aliases
# ==============================
alias cp="cp -iv"
alias mv="mv -iv"
alias ln="ln -i"
alias rm="rm -vI"
alias bc="bc -ql"
alias ka="killall"
alias du="dust -d 2 --reverse"
alias python="python -q"
alias less="bat --paging=always --plain"

# ==============================
# nixos-rebuild wrapper
# ==============================
nixos-rebuild() {
  sudo command nixos-rebuild --flake "$HOME/.dotfiles#laptop" "$@"
}

# ==============================
# Colorized commands
# ==============================
alias ls="eza -h --icons --group-directories-first --color=always"
alias grep="grep -i --color=auto"
alias diff="diff --color=auto"
alias ip="ip -color=auto"
alias cat="bat -pp"

# ==============================
# Misc shortcuts
# ==============================
alias lf="lfub"
alias magit="nvim -c MagitOnly"
alias ref="shortcuts >/dev/null; \
  source ${XDG_CONFIG_HOME:-$HOME/.config}/shell/shortcutrc; \
  source ${XDG_CONFIG_HOME:-$HOME/.config}/shell/shortcutenvrc; \
  source ${XDG_CONFIG_HOME:-$HOME/.config}/shell/zshnameddirrc"
